{"version":3,"file":"fench.es5.js","sources":["../src/abortablePromise.ts","../src/interceptor.ts","../src/fRequest.ts","../src/fResponse.ts","../src/fench.ts"],"sourcesContent":["interface IAbortablePromise {\n  abortController: AbortController;\n  promise: Promise<any>;\n}\n\ntype PromiseExecutor = (\n  resolve?: (value?: any) => void,\n  reject?: (value?: any) => void,\n  abortSignal?: AbortSignal\n) => any;\n\nclass AbortablePromise implements AbortController {\n  public static resolve(aborter = null, data) {\n    return new AbortablePromise(Promise.resolve(data), aborter);\n  }\n\n  public static reject(aborter = null, err) {\n    return new AbortablePromise(Promise.reject(err), aborter);\n  }\n\n  public static race(aborter = null, data) {\n    return new AbortablePromise(Promise.race(data), aborter);\n  }\n\n  public static all(aborter = null, data) {\n    return new AbortablePromise(Promise.all(data), aborter);\n  }\n\n  public signal: AbortSignal;\n  public abortController: AbortController;\n\n  private promise: Promise<any>;\n\n  constructor(\n    executor: Promise<any> | PromiseExecutor,\n    aborter: AbortController | null = null\n  ) {\n    this.abortController = aborter || new AbortController();\n    if (executor instanceof Promise) {\n      this.promise = executor;\n    } else {\n      this.promise = new Promise((resolve, reject) =>\n        executor(resolve, reject, this.abortController.signal)\n      );\n    }\n  }\n\n  public then(...args) {\n    return new AbortablePromise(\n      this.promise.then(...args),\n      this.abortController\n    );\n  }\n\n  public catch(...args) {\n    return new AbortablePromise(\n      this.promise.catch(...args),\n      this.abortController\n    );\n  }\n\n  public finally(...args) {\n    return this.promise.finally(...args);\n  }\n\n  public abort() {\n    return this.abortController.abort();\n  }\n}\n\nexport default AbortablePromise;\n","import AbortablePromise from \"./abortablePromise\";\nimport createResponse from \"./fResponse\";\n\ninterface IInterceptor {\n  request?: (request?: any) => any;\n  requestError?: (err?: any) => any;\n  response?: (response?: any, request?: any) => any;\n  responseError?: (err?: any) => any;\n}\n\ninterface IInterceptors {\n  interceptors: IInterceptor[];\n  API: object;\n}\n\nclass Interceptors implements IInterceptors {\n  public interceptors;\n  public API;\n\n  constructor(API: object, interceptableMethods: any[] = []) {\n    this.interceptors = [];\n\n    if (!API) {\n      throw new Error(\"API should be passed to the Interceptor\");\n    }\n    this.API = API;\n\n    if (interceptableMethods.length === 0) {\n      throw new Error(\"no methods were added to interceptableMethods\");\n    }\n\n    interceptableMethods.forEach(methodName => {\n      const methodFn = API[methodName];\n      API[methodName] = (...args) => this.interceptedMethod(methodFn, ...args);\n    });\n  }\n\n  public register(interceptor) {\n    this.interceptors.push(interceptor);\n    return () => this.unregister(interceptor);\n  }\n\n  public unregister(interceptor) {\n    const index = this.interceptors.indexOf(interceptor);\n    if (index >= 0) {\n      this.interceptors.splice(index, 1);\n    }\n  }\n\n  public clear() {\n    this.interceptors = [];\n  }\n\n  private interceptedMethod(methodFn, ...args) {\n    // const { interceptors, API } = this;\n    const reversedInterceptors = this.interceptors.slice().reverse();\n\n    const abortController = new AbortController();\n    let promise = AbortablePromise.resolve(abortController, args);\n\n    // Register request interceptors\n    this.interceptors.forEach(({ request, requestError }) => {\n      if (typeof request === \"function\") {\n        promise = promise.then(args =>\n          request(promise.abortController.signal, ...[].concat(args))\n        );\n      }\n      if (typeof requestError === \"function\") {\n        promise = promise.catch(requestError);\n      }\n    });\n\n    // Register methodFn call\n    if (typeof methodFn === \"function\") {\n      promise = promise.then(args =>\n        methodFn(promise.abortController.signal, ...[].concat(args))\n      );\n    }\n\n    // Register response interceptors\n    reversedInterceptors.forEach(({ response, responseError }) => {\n      if (typeof response === \"function\") {\n        promise = promise.then(response);\n      }\n      if (typeof responseError === \"function\") {\n        promise = promise.catch(responseError);\n      }\n    });\n\n    let timeout = 0;\n\n    if (\n      typeof args[args.length - 1] === \"object\" &&\n      typeof args[args.length - 1].timeout === \"number\"\n    ) {\n      timeout = args[args.length - 1].timeout;\n    } else {\n      timeout = this.API.timeout;\n    }\n\n    if (timeout > 0) {\n      const timer = new Promise((resolve, reject) => {\n        setTimeout(() => {\n          reject(new Error(\"Timeout exceeded\"));\n        }, timeout);\n      });\n\n      return AbortablePromise.race(abortController, [promise, timer]).then(\n        value => value,\n        err => {\n          if (err && err.message === \"Timeout exceeded\") {\n            promise.abort();\n          }\n          return Promise.reject(err);\n        }\n      );\n    }\n    return promise;\n  }\n}\n\nexport default Interceptors;\n","// import urlJoin from \"url-join\";\n// import qs from \"qs\";\n\nconst urlJoin = require(\"url-join\");\nconst qs = require(\"qs\");\n\nexport interface IFenchRequest {\n  body?: object;\n  path: string;\n  headers: object;\n  method?: string;\n  mode: string;\n  raw?: Request;\n  params?: object;\n  signal: AbortSignal;\n  url: string;\n}\n\ninterface IOptions {\n  params?: object;\n  body?: object;\n  headers?: object;\n  method?: string;\n  mode?: string;\n}\n\nexport default function createRequest(args: {\n  baseURI: string;\n  globalHeaders: object;\n  path: string;\n  options: IOptions;\n  arrayFormat: string;\n  abortSignal: AbortSignal;\n}): IFenchRequest {\n  const {\n    baseURI,\n    globalHeaders,\n    path,\n    options,\n    arrayFormat,\n    abortSignal\n  } = args;\n\n  const opts: any = {};\n  // Creating URI\n  const fullUri = urlJoin(\n    baseURI,\n    path,\n    `${\n      options.params ? \"?\" + qs.stringify(options.params, { arrayFormat }) : \"\"\n    }`\n  );\n\n  // Creating headers\n  // remove any null or blank headers\n  // (e.g. to automatically set Content-Type with `FormData` boundary)\n  // const headers = new Headers();\n  const headersObj = {};\n  Object.entries(options.headers).forEach(([key, value]) => {\n    if ((typeof value !== \"undefined\" && value !== null) || value !== \"\") {\n      headersObj[key] = value;\n    }\n  });\n  opts.headers = new Headers(headersObj);\n\n  if (options.method) {\n    opts.method =\n      options.method === \"del\" ? \"DELETE\" : options.method.toUpperCase();\n  } else {\n    options.method = \"GET\";\n  }\n\n  // Creating body if nedeed\n  if (\n    options.method.toLowerCase() !== \"get\" &&\n    options.method.toLowerCase() !== \"head\"\n  ) {\n    opts.body = options.body;\n  }\n\n  if (options.mode) {\n    opts.mode = options.mode;\n  }\n\n  opts.signal = abortSignal;\n\n  return {\n    ...opts,\n    path,\n    params: options.params,\n    raw: new Request(fullUri, opts),\n    url: fullUri\n  };\n}\n","import { IFenchRequest } from \"./fRequest\";\n\ntype ModernHeaders = Headers & {\n  [Symbol.iterator](): Iterator<string[]>;\n};\n\nexport interface IFenchResponse {\n  body?: object | string | Blob;\n  path: string;\n  err?: Error;\n  headers: object;\n  ok: boolean;\n  raw: Response;\n  request: IFenchRequest;\n  status: number;\n  statusText: string;\n  type: string;\n  url: string;\n}\n\nasync function parseResponse(res: Response, contentType: string) {\n  let body: any = null;\n  let err: any = null;\n  if (res.ok) {\n    if (contentType && contentType.includes(\"application/json\")) {\n      try {\n        if (typeof res.json === \"function\") {\n          body = await res.json();\n        } else {\n          body = await res.text();\n          body = JSON.parse(body);\n        }\n      } catch (err) {\n        return err;\n      }\n    } else {\n      body = await res.text();\n    }\n  } else {\n    err = new Error(res.statusText);\n\n    // check if the response was JSON, and if so, better the error\n    if (contentType && contentType.includes(\"application/json\")) {\n      try {\n        // // attempt to parse json body to use as error message\n        if (typeof res.json === \"function\") {\n          body = await res.json();\n        } else {\n          body = await res.text();\n          body = JSON.parse(body);\n        }\n\n        // attempt to use better and human-friendly error messages\n        if (typeof body === \"object\" && typeof body.message === \"string\") {\n          err = new Error(body.message);\n        } else if (\n          !Array.isArray(body) &&\n          // attempt to utilize Stripe-inspired error messages\n          typeof body.error === \"object\"\n        ) {\n          if (body.error.message) {\n            err = new Error(body.error.message);\n          }\n          if (body.error.stack) {\n            err.stack = body.error.stack;\n          }\n          if (body.error.code) {\n            err.code = body.error.code;\n          }\n          if (body.error.param) {\n            err.param = body.error.param;\n          }\n        }\n      } catch (e) {\n        err = e;\n      }\n    }\n  }\n  return { body, err };\n}\n\nexport default async function createResponse(\n  rawResponse: Response,\n  fRequest: IFenchRequest\n): Promise<IFenchResponse> {\n  const fResponse: IFenchResponse = {\n    body: null,\n    path: fRequest.path,\n    headers: {},\n    ok: rawResponse.ok,\n    raw: rawResponse,\n    request: fRequest,\n    status: rawResponse.status,\n    statusText: rawResponse.statusText,\n    type: rawResponse.type,\n    url: rawResponse.url\n  };\n\n  for (const [key, value] of rawResponse.headers as any) {\n    fResponse.headers[key] = value;\n  }\n\n  const { body, err } = await parseResponse(\n    rawResponse,\n    rawResponse.headers.get(\"Content-Type\")\n  );\n\n  if (err) {\n    fResponse.err = err;\n  }\n  fResponse.body = body;\n  return fResponse;\n}\n","import Interceptor from \"./interceptor\";\nimport createRequest, { IFenchRequest } from \"./fRequest\";\nimport createResponse, { IFenchResponse } from \"./fResponse\";\n\nconst methods = [\n  \"get\",\n  \"head\",\n  \"post\",\n  \"put\",\n  \"del\",\n  \"delete\",\n  \"options\",\n  \"patch\"\n];\n\ntype FenchOptions = RequestInit & {\n  parseErr?: Error;\n  headers?: { Authorization: string } & object;\n  baseURI?: string;\n  raw?: boolean;\n  arrayFormat?: string;\n  auth?: object;\n  timeout?: number;\n  body?: object;\n  signal?: object;\n};\n\nclass Fench {\n  public interceptor: object;\n  public timeout: number;\n  public parseErr?: Error;\n  public req: any;\n\n  private opts: FenchOptions;\n  private headers: object;\n  private raw: boolean;\n  private arrayFormat: string;\n  private fetch: any;\n\n  constructor(opts: FenchOptions = {}, fetchImpl = null) {\n    this.opts = opts;\n\n    this.fetch = fetchImpl || fetch.bind(global);\n\n    Object.defineProperty(this, \"parseErr\", {\n      enumerable: false,\n      value:\n        opts.parseErr ||\n        new Error(\n          `Invalid JSON received${opts.baseURI ? ` from ${opts.baseURI}` : \"\"}`\n        )\n    });\n\n    this.opts.arrayFormat = opts.arrayFormat || \"indices\";\n\n    methods.forEach(method => {\n      this[method] = this.setup(method);\n    });\n\n    this.req = (abortSignal: AbortSignal, request: IFenchRequest) => {\n      return this.makeRequest(abortSignal, request);\n    };\n\n    // interceptor should be initialized after methods setup\n    this.interceptor = new Interceptor(this, [...methods, \"req\"]);\n    this.timeout = opts.timeout || 0;\n  }\n\n  // public auth(creds) {\n  //   if (typeof creds === \"string\") {\n  //     const index = creds.indexOf(\":\");\n  //     if (index !== -1)\n  //       creds = [creds.substr(0, index), creds.substr(index + 1)];\n  //   }\n\n  //   if (!Array.isArray(creds)) {\n  //     // eslint-disable-next-line prefer-rest-params\n  //     creds = [].slice.call(arguments);\n  //   }\n\n  //   switch (creds.length) {\n  //     case 0:\n  //       creds = [\"\", \"\"];\n  //       break;\n  //     case 1:\n  //       creds.push(\"\");\n  //       break;\n  //     case 2:\n  //       break;\n  //     default:\n  //       throw new Error(\"auth option can only have two keys `[user, pass]`\");\n  //   }\n\n  //   if (typeof creds[0] !== \"string\") {\n  //     throw new TypeError(\"auth option `user` must be a string\");\n  //   }\n\n  //   if (typeof creds[1] !== \"string\") {\n  //     throw new TypeError(\"auth option `pass` must be a string\");\n  //   }\n\n  //   if (!creds[0] && !creds[1]) {\n  //     delete this.headers.Authorization;\n  //   } else {\n  //     this.headers.Authorization = `Basic ${Buffer.from(\n  //       creds.join(\":\")\n  //     ).toString(\"base64\")}`;\n  //   }\n\n  //   return this;\n  // }\n  // public req(abortSignal: AbortSignal, request: IFenchRequest) {\n  //   return this.makeRequest(abortSignal, request);\n  // }\n\n  public jwt(token) {\n    if (token === null) {\n      delete this.opts.headers.Authorization;\n    } else if (typeof token === \"string\") {\n      this.opts.headers.Authorization = `Bearer ${token}`;\n    } else {\n      throw new TypeError(\"jwt token must be a string\");\n    }\n\n    return this;\n  }\n\n  private makeRequest(abortSignal: AbortSignal, fRequest: IFenchRequest) {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const rawResponse = await this.fetch(fRequest.raw);\n        const fResponse = await createResponse(rawResponse, fRequest);\n\n        resolve(fResponse);\n      } catch (err) {\n        reject(err);\n      }\n    });\n  }\n\n  private prepareRequest(\n    abortSignal,\n    pathOrRequest = \"/\",\n    options: FenchOptions\n  ) {\n    if (options && (typeof options !== \"object\" || Array.isArray(options))) {\n      throw new TypeError(\"`options` must be an object\");\n    }\n    options = {\n      ...this.opts,\n      ...options\n    };\n\n    let fRequest: any = null;\n\n    const req = <IFenchRequest>(<unknown>pathOrRequest);\n    if (req.headers) {\n      fRequest = req;\n    } else {\n      if (typeof pathOrRequest !== \"string\") {\n        throw new TypeError(\"`path` must be a string\");\n      }\n\n      fRequest = createRequest({\n        baseURI: this.opts.baseURI,\n        globalHeaders: this.opts.headers,\n        path: pathOrRequest,\n        options,\n        arrayFormat: this.opts.arrayFormat,\n        abortSignal\n      });\n    }\n\n    return fRequest;\n  }\n\n  private setup(method) {\n    return (abortSignal, pathOrRequest = \"/\", options: FenchOptions) => {\n      const request = this.prepareRequest(abortSignal, pathOrRequest, options);\n      return this.makeRequest(abortSignal, request);\n    };\n  }\n}\n\nexport default Fench;\n"],"names":["tslib_1.__values","tslib_1.__read","Interceptor"],"mappings":"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"}